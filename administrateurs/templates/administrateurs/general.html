<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard - ISFAD</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    * {
      margin: 0; padding: 0; box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }
    body {
      display: flex;
      background-color: #f4f7fc;
      min-height: 100vh;
      color: #333;
    }
    .sidebar {
  display: flex;
  flex-direction: column;
  justify-content: space-between; /* top menu, center icon, bottom footer */
  width: 240px;
  height: 100vh; /* plein écran vertical */
  position: fixed;
  top: 0; left: 0;
  background-color: #1e293b;
  color: #fff;
  padding: 20px;
  box-sizing: border-box;
  text-align: center;
}

/* Titre ISFAD */
.sidebar h2 {
  margin-bottom: 40px;
  font-size: 22px;
}

/* Menu liens : centré verticalement et horizontalement */
.sidebar ul {
  list-style: none;
  padding-left: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center; /* centre horizontalement les <li> */
  gap: 20px;
  font-weight: 600;
}

.sidebar ul li {
  cursor: pointer;
  transition: color 0.3s;
}

/* Liens */
.sidebar ul li a {
  color: white;
  text-decoration: none;
  padding: 8px 12px;
  display: inline-block;
  border-radius: 6px;
  width: 100%;
  text-align: center;
}

.sidebar ul li a:hover {
  background-color: #2563eb;
  color: white;
}

/* Active sans soulignement mais fond léger */
.sidebar ul li a.active,
.sidebar ul li a.active:hover {
  background-color: rgba(37, 99, 235, 0.7);
  color: white;
  text-decoration: none;
}

/* Zone centrale pour la grosse icône */
.sidebar-center {
  flex-grow: 1; /* prend tout l’espace entre menu et footer */
  display: flex;
  justify-content: center;
  align-items: center;
}

/* Grosse icône ronde */
.big-icon {
  width: 120px;
  height: 120px;
  background-color: white;
  border-radius: 50%;
  mask: url('https://cdn-icons-png.flaticon.com/512/2948/2948035.png') no-repeat center;
  mask-size: contain;
  -webkit-mask: url('https://cdn-icons-png.flaticon.com/512/2948/2948035.png') no-repeat center;
  -webkit-mask-size: contain;
  cursor: pointer;
}

/* Footer bas de sidebar avec liens + petite icône */
.sidebar-bottom {
  display: flex;
  justify-content: center;
  gap: 20px;
  padding-top: 15px;
  border-top: 1px solid rgba(255,255,255,0.3);
}

/* Liens footer */
.sidebar-bottom a {
  color: white;
  text-decoration: none;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.9rem;
  cursor: pointer;
}

.sidebar-bottom a:hover {
  opacity: 0.8;
}

/* Petite icône dans footer */
.sidebar-bottom a.icon-link .icon {
  width: 18px;
  height: 18px;
  display: inline-block;
  background-color: white;
  mask: url('https://cdn-icons-png.flaticon.com/512/25/25231.png') no-repeat center;
  mask-size: contain;
  -webkit-mask: url('https://cdn-icons-png.flaticon.com/512/25/25231.png') no-repeat center;
  -webkit-mask-size: contain;
}

    .main-content {
      flex-grow: 1;
      padding: 20px;
    }

    header {
      background-color: #fff;
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .card {
      background-color: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      text-align: center;
      transition: transform 0.2s;
    }
    .card:hover {
      transform: translateY(-4px);
    }
    .card h3 {
      font-size: 18px;
      margin-bottom: 10px;
    }
    .card p {
      font-size: 24px;
      font-weight: bold;
      color: #2563eb;
    }
    .chart, .table-section {
      background-color: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      margin-bottom: 30px;
    }
    .table-section table {
      width: 100%;
      border-collapse: collapse;
    }
    .table-section th, .table-section td {
      padding: 12px;
      border: 1px solid #e2e8f0;
      text-align: left;
    }
    .table-section th {
      background-color: #f1f5f9;
    }
   @media (max-width: 768px) {
  .sidebar {
    display: none !important;  /* Masque complètement la sidebar */
  }
  .main-content {
    margin-left: 0 !important;  /* Supprime la marge de gauche */
    padding: 10px !important;   /* Ajuste le padding */
    width: 100% !important;     /* Prend toute la largeur possible */
  }
}

#amar{
  margin-left: 15px; padding: 6px 12px; border: none; background: #2563eb; color: white; border-radius: 5px;
}
#amar a{
  text-decoration: none;color: white;
}

    .main-content {
  margin-left: 240px; /* largeur de ta sidebar */
  padding: 20px; /* ou ce que tu veux */
  box-sizing: border-box;
}
  </style>
</head>
<body>
  {% include 'administrateurs/sidebar.html' %}

  <div class="main-content">
    <header>
      <h1>Tableau de bord</h1>
      <div>
        <strong>Bienvenue, Maina</strong>
        <form action="{% url 'deconnection' %}" method="POST">
          {% csrf_token %}
          <button type="submit" id="amar">Déconnexion</button>
        </form>
      </div>
    </header>

    <section class="cards">
      <div class="card">
        <h3>Utilisateurs connectés</h3>
        <p id="usersCount">--</p>
      </div>
      <div class="card">
        <h3>Nombre de départements</h3>
        <p id="departmentsCount">5</p>
      </div>
      <div class="card">
        <h3>Nombre total de matières</h3>
        <p id="subjectsCount">27</p>
      </div>
      <div class="card">
        <h3>Total élèves ISFAD</h3>
        <p id="studentsCount">340</p>
      </div>
    </section>

    <section class="chart">
      <h2>Utilisateurs connectés (temps réel)</h2>
      <canvas id="resultChart" height="100"></canvas>
    </section>

    <section class="table-section">
      <h2>6 derniers profs récemment en ligne</h2>
      <table>
        <thead>
          <tr>
            <th>Nom</th>
            <th>Email</th>
            <th>Dernière connexion</th>
          </tr>
        </thead>
        <tbody id="profList"></tbody>
      </table>
    </section>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Fonction pour afficher "temps écoulé" en format lisible
    function timeSince(date) {
      const seconds = Math.floor((new Date() - date) / 1000);
      if (seconds < 60) return seconds + " sec";
      const intervals = [
        { label: "an", seconds: 31536000 },
        { label: "mois", seconds: 2592000 },
        { label: "jour", seconds: 86400 },
        { label: "heure", seconds: 3600 },
        { label: "minute", seconds: 60 }
      ];
      for (const interval of intervals) {
        const count = Math.floor(seconds / interval.seconds);
        if (count > 0) return count + " " + interval.label + (count > 1 ? "s" : "");
      }
      return "à l'instant";
    }

    // Formate le temps en mm:ss pour l'axe du graphique
    function formatTime(seconds) {
      const min = Math.floor(seconds / 60);
      const sec = seconds % 60;
      return `${min}:${sec.toString().padStart(2, '0')}`;
    }

    // Initialisation Chart.js
    const ctx = document.getElementById('resultChart').getContext('2d');
    const chartData = {
      labels: [],
      datasets: [{
        label: 'Utilisateurs connectés',
        data: [],
        borderColor: '#16a34a',
        backgroundColor: 'rgba(22, 163, 74, 0.1)',
        fill: true,
        tension: 0.3
      }]
    };
    const userChart = new Chart(ctx, {
      type: 'line',
      data: chartData,
      options: {
        responsive: true,
        animation: false,
        scales: {
          x: {
            title: {
              display: true,
              text: 'Temps (mm:ss)'
            }
          },
          y: {
            beginAtZero: true,
            suggestedMax: 20,
            title: {
              display: true,
              text: 'Nb connectés'
            }
          }
        }
      }
    });

    let elapsedSeconds = 0;

    setInterval(() => {
      const connectedUsers = Math.floor(Math.random() * 10) + 5; // simulate 5-15 users
      if (chartData.labels.length >= 10) {
        chartData.labels.shift();
        chartData.datasets[0].data.shift();
      }
      elapsedSeconds += 10;
      chartData.labels.push(formatTime(elapsedSeconds));
      chartData.datasets[0].data.push(connectedUsers);
      userChart.update();
      document.getElementById("usersCount").textContent = connectedUsers;
    }, 10000);

    // Liste des professeurs (exemple)
    const professeurs = [
      { nom: "Fatou Diallo", email: "fatou@exemple.com" },
      { nom: "Alpha Condé", email: "aconde@exemple.com" },
      { nom: "Moussa Keita", email: "mkeita@exemple.com" },
      { nom: "Aïssata Soumah", email: "asoumah@exemple.com" },
      { nom: "Ibrahima Sory", email: "isory@exemple.com" },
      { nom: "Boubacar Bah", email: "bbah@exemple.com" },
      { nom: "Kadiatou Barry", email: "kbarry@exemple.com" },
      { nom: "Amadou Sylla", email: "asylla@exemple.com" },
      { nom: "Mariama Camara", email: "mcamara@exemple.com" }
    ];

    let connectedProfs = [];

    function updateProfList() {
      const randomProf = professeurs[Math.floor(Math.random() * professeurs.length)];
      const now = new Date();

      // On enlève si déjà dans la liste pour éviter doublons
      connectedProfs = connectedProfs.filter(p => p.email !== randomProf.email);
      connectedProfs.unshift({ ...randomProf, lastConnection: now });

      // Limite 6 derniers profs
      if (connectedProfs.length > 6) {
        connectedProfs.pop();
      }

      const tbody = document.getElementById("profList");
      tbody.innerHTML = connectedProfs.map(prof => `
        <tr>
          <td>${prof.nom}</td>
          <td>${prof.email}</td>
          <td>${timeSince(prof.lastConnection)}</td>
        </tr>
      `).join("");
    }

    updateProfList();
    setInterval(updateProfList, 5000);
  </script>
</body>
</html>
