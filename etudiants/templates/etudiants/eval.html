{% load static %}

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'etudiants/css/evaluation.css' %}">
  <title>ISFAD | Evaluation</title>

  <!-- Styles hover glow pour boutons Faire le test / Infos et alignement -->
  <style>
    .test-card .btn-link {
        color: #ffffff;
        background-color: #007bff;
        border-radius: 5px;
        padding: 8px 12px;
        text-decoration: none;
        display: inline-block;
        transition: all 0.3s ease;
        box-shadow: 0 0 0 rgba(0,0,0,0);
    }

    .test-card .btn-link:hover {
        background-color: #0056b3;
        color: #ffdd57;
        box-shadow: 0 0 10px #ffdd57, 0 0 20px #ffdd57;
        transform: translateY(-2px);
    }

    /* Flex pour aligner boutons et infos */
    .test-card .buttons-and-status {
        display: flex;
        justify-content: space-between; /* boutons √† gauche, infos √† droite */
        align-items: center;
        margin-top: 10px;
    }

    .test-card .status-and-days {
        display: flex;
        flex-direction: column;    /* statut au-dessus du nombre de jours */
        align-items: flex-end;     /* alignement √† droite */
    }

    .test-card .status {
        margin: 0;
    }

    .test-card .days-remaining {
        margin: 0;
        font-size: 0.9em;
        color: #555;
    }
  </style>
</head>
<body>

<header>
  <h2>√âvaluations & Tests</h2>
  <nav>
    <ul>
      <li><a href="{% url 'accueil'%}">Accueil</a></li>
      <li><a href="{% url 'profil'%}">Profil</a></li>
      <li><a href="{% url 'parametres'%}">‚öôÔ∏è Param√®tres</a></li>
    </ul>
  </nav>
</header>

{% if request.user.is_authenticated %}
    {% if request.user.role == "prof" %}
      <div class="container">
        <div id="action-buttons">
          <section>
            <div class="button-group">
              <button class="action-btn">
                <i class="fas fa-plus-circle"></i> Ajouter un test
              </button>
              <button class="action-btn">
                <i class="fas fa-book"></i> Ajouter un devoir
              </button>
              <button class="action-btn">
                <i class="fas fa-folder-open"></i> Afficher devoirs rendus
              </button>
              <button class="action-btn">
                <i class="fas fa-check-circle"></i> Valider notes
              </button>
              <button class="action-btn">
                <i class="fas fa-trash-alt"></i> Supprimer
              </button>
            </div>
          </section>
        </div>
        <h1 style="text-align: center;">Tester la comprehension de vos √©tudiants</h1>

        <div class="container-fluid">
          <table class="table table-hover table-bordered w-100 text-center">
            <thead class="table-dark">
              <tr>
                <th scope="col">Matricule</th>
                <th scope="col">Pr√©nom</th>
                <th scope="col">Nom</th>
                <th scope="col">Groupe</th>
              </tr>
            </thead>
            <tbody>
              {% for etud in etudiant %}
                <tr>
                  <td>{{ etud.id }}</td>
                  <td>{{ etud.first_name }}</td>
                  <td>{{ etud.last_name }}</td>
                  <td>{{ etud.groupe }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

    {% elif request.user.role == "etud" %}
      <div class="container">
        <h1 style="text-align: center;">Bonne chance pour vos Tests vous en aurez besoin</h1>
        <button>Filtrer</button>
        <br>

        {% if evaluation %}
          {% for i in evaluation %}
            <div id="test-container">
              <div class="test-card">
                <h3>{{ i.titre }}</h3>
                <p><strong>Mati√®re : {{ i.matiere }}</strong> </p>
                <p>Essais restants : 2 / {{ i.nombre_essaie }}</p>

                <div class="buttons-and-status">
                  <div class="buttons">
                      <a href="#" class="btn-link"><i class="fas fa-play"></i> Faire le test</a>
                      <button class="btn-link"><i class="fas fa-info-circle"></i> Infos</button>
                  </div>
                  <div class="status-and-days">
                      <div class="status non-termine">Pas commenc√©</div>
                      <div class="days-remaining">
                        {% if i.jours_restants > 0 %}
                          ‚è≥ {{ i.jours_restants }} jour{% if i.jours_restants > 1 %}s{% endif %} restant{% if i.jours_restants > 1 %}s{% endif %}
                        {% else %}
                          ‚ùå Expir√©
                        {% endif %}
                      </div>
                  </div>
                </div>

              </div>
            </div>
          {% endfor %}
        {% else %}
          <h2>Pas d'√©valuation pour l'instant... Bonne pr√©paration</h2>
        {% endif %}

        {% if devoir %}
          {% for j in devoir %}
            <div class="test-card">
              <h3>üìò Devoir : {{ j.titre }}</h3>
              <p><strong>Mati√®re :</strong> {{ j.matiere }}</p>
              <p>Date limite : {{ j.date_limite }}</p>

              <div class="buttons-and-status">
                  <div class="buttons">
                      <a href="#" class="btn-link"><i class="fas fa-upload"></i> Rendre le devoir</a>
                      <button class="btn-link"><i class="fas fa-info-circle"></i> Infos</button>
                  </div>
                  <div class="status-and-days">
                      <div class="status termine">Termin√© - Note : 8 / 10</div>
                      <div class="days-remaining">
                        {% if j.jours_restants > 0 %}
                          ‚è≥ {{ j.jours_restants }} jour{% if j.jours_restants > 1 %}s{% endif %} restant{% if j.jours_restants > 1 %}s{% endif %}
                        {% else %}
                          ‚ùå Expir√©
                        {% endif %}
                      </div>
                  </div>
              </div>

            </div>
          {% endfor %}
        {% else %}
          <h2>Pas de devoir pour l'instant</h2>
        {% endif %}

    {% endif %}
{% endif %}

<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

</body>
</html>
