
{% load static %}

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="{% static 'etudiants/css/section.css' %}">

  <title>ISFAD | Section Cours </title>
</head>
<body>

  <div id="menu">
    <div class="breadcrumbs" style="font-size: 14px; color: #555;">
      <a href="{% url 'accueil' %}">Accueil</a> &gt;
      <a href="{% url 'licence'%}">Licence</a> &gt;
      <a href="{% url 'choix_cours'%}">Cours</a> &gt;
      <span style="font-weight: bold;">Liste des cours</span>
    </div>
    
    <nav>
      <a href="{% url 'profil'%}"><i class="fas fa-user"></i> Profil</a>

      <a href="{% url 'parametres'%}">‚öôÔ∏è Parametres</a>
    </nav>
  </div>

  <h1>Liste des Cours avec Chapitres et Le√ßons</h1>
    <div style="text-align: center; margin-bottom: 30px;">
      <button onclick="ouvrirPopup()" style="background-color: #1d3557; color: white; padding: 10px 20px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;">
        <i class="fas fa-tasks" style="color:#2196F3;"></i> Ajouter un cours
      </button>
    </div>





<!-- Modal d'ajout de cours -->
<!-- Popup d'ajout de cours -->
<div id="coursPopup" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#00000080; z-index:9999; justify-content:center; align-items:center;">
  <div style="background:white; padding:20px; border-radius:10px; width:90%; max-width:400px; position:relative;">
    <h2><i class="fas fa-tasks" style="color:#2196F3;"></i> Ajouter un cours</h2>
    <label>Nom du cours :</label>
    <input type="text" id="coursNom" placeholder="Ex: Statistiques" style="width:100%; padding:8px;"><br><br>

    <label>Chapitre :</label>
    <select id="coursChapitre" style="width:100%; padding:8px;">
      <option value="Chapitre 1">Chapitre 1</option>
      <option value="Chapitre 2">Chapitre 2</option>
      <option value="Chapitre 3">Chapitre 3</option>
      <option value="Chapitre 4">Chapitre 4</option>
      <option value="Chapitre 5">Chapitre 5</option>
      <option value="Chapitre 6">Chapitre 6</option>
      <option value="Chapitre 7">Chapitre 7</option>
      <option value="Chapitre 8">Chapitre 8</option>
      <option value="Chapitre 9">Chapitre 9</option>
    </select><br><br>

    <label>Description :</label>
    <textarea id="coursDescription" placeholder="Description du cours..." style="width:100%; padding:8px;"></textarea><br><br>

    <label>Lien de partage d'√©cran :</label>
    <input type="url" id="coursLien" placeholder="https://..." style="width:100%; padding:8px;"><br><br>

    <button onclick="ajouterCours()" style="background:#1976d2; color:white; padding:10px 20px; border:none; border-radius:5px;">Ajouter</button>
    <button onclick="fermerPopup()" style="margin-left:10px; padding:10px 20px;">Annuler</button>
  </div>
</div>

  <ul class="course-list" id="courseList"></ul>

  <!-- Modal description -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalDesc">
    <div class="modal-content">
      <button class="modal-close" aria-label="Fermer la fen√™tre">&times;</button>
      <h2 id="modalTitle">Description du cours</h2>
      <p id="modalDesc"></p>
    </div>
  </div>
  <!-- Bouton "Ajouter un cours" -->


  <script>
    // Fonction pour g√©n√©rer dynamiquement 5 chapitres pour un cours donn√©
function genererChapitres(baseTitre) {
  const chapitres = [];
  for (let i = 1; i <= 5; i++) {
    chapitres.push({
      titre: `Chapitre ${i} : ${baseTitre} th√®me ${i}`, // Titre du chapitre avec num√©ro et th√®me
      lecon: `Le√ßon ${i}`,                             // Nom de la le√ßon
      suivi: i % 2 === 1,                             // Statut suivi : true si impair, false sinon
      // Liens dynamiques g√©n√©r√©s √† partir du titre de base en minuscule sans espaces
      pointControleLink: `https://example.com/${baseTitre.toLowerCase().replace(/\s/g, '')}-pointcontrole${i}`,
      descriptionCours: `Ceci est une description d√©taill√©e du cours "${baseTitre}", chapitre ${i}. Ici vous pouvez expliquer les objectifs, les notions abord√©es, etc.`,
      pdf1: `https://example.com/${baseTitre.toLowerCase().replace(/\s/g, '')}-pdf1-chapitre${i}.pdf`,
      pdf2: `https://example.com/${baseTitre.toLowerCase().replace(/\s/g, '')}-pdf2-chapitre${i}.pdf`,
      video1: `https://example.com/${baseTitre.toLowerCase().replace(/\s/g, '')}-video${i}a`,
      video2: `https://example.com/${baseTitre.toLowerCase().replace(/\s/g, '')}-video${i}b`
    });
  }
  return chapitres;
}

// Liste des cours avec leurs chapitres g√©n√©r√©s
const allCourses = [
  {
    titre: "Fonctions de base",
    chapitres: genererChapitres("Fonctions de base")
  },
  {
    titre: "Probabilit√©s",
    chapitres: genererChapitres("Probabilit√©s")
  }
];

// R√©cup√©ration des √©l√©ments du DOM n√©cessaires pour l'affichage et la modal
const courseListEl = document.getElementById('courseList');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const modalDesc = document.getElementById('modalDesc');
const modalCloseBtn = modal.querySelector('.modal-close');

// Fonction pour ouvrir la modal avec un titre et une description
function openModal(title, description) {
  modalTitle.textContent = title;       // Mise √† jour du titre
  modalDesc.textContent = description;  // Mise √† jour de la description
  modal.style.display = 'flex';          // Affichage de la modal (flex pour centrage)
}

// Fonction pour fermer la modal
function closeModal() {
  modal.style.display = 'none';          // Cache la modal
}

// √âv√©nement pour fermer la modal en cliquant sur la croix
modalCloseBtn.addEventListener('click', closeModal);

// √âv√©nement pour fermer la modal en cliquant √† l'ext√©rieur du contenu
modal.addEventListener('click', (e) => {
  if (e.target === modal) closeModal();
});

// ----------- Gestion du suivi individuel en localStorage -----------

// R√©cup√®re le statut "suivi" d'un chapitre d'un cours dans localStorage
function getSuiviStatus(courseTitle, chapterTitle) {
  const stored = localStorage.getItem('suiviStatus');
  if (!stored) return null;  // Pas de donn√©es stock√©es, renvoie null
  const statuses = JSON.parse(stored);
  // Utilise l'op√©rateur optionnel pour √©viter les erreurs si les cl√©s n'existent pas
  return statuses?.[courseTitle]?.[chapterTitle] ?? null;
}

// Enregistre le statut "suivi" d'un chapitre d'un cours dans localStorage
function setSuiviStatus(courseTitle, chapterTitle, status) {
  let statuses = {};
  const stored = localStorage.getItem('suiviStatus');
  if (stored) {
    statuses = JSON.parse(stored);
  }
  if (!statuses[courseTitle]) statuses[courseTitle] = {};
  statuses[courseTitle][chapterTitle] = status;
  localStorage.setItem('suiviStatus', JSON.stringify(statuses));
}

// ----------- Fonction pour afficher la liste des cours et chapitres -----------

function renderCourseList() {
  courseListEl.innerHTML = ''; // Vide la liste avant d'afficher

  allCourses.forEach(cours => {
    // Cr√©ation de la carte du cours
    const courseCard = document.createElement('li');
    courseCard.className = 'course-card';

    // Titre du cours
    const courseTitle = document.createElement('div');
    courseTitle.className = 'course-title';
    courseTitle.textContent = cours.titre;

    // Liste des chapitres du cours
    const chaptersList = document.createElement('ul');
    chaptersList.className = 'chapters-list';

    // Pour chaque chapitre du cours...
    cours.chapitres.forEach((chapitre, idx) => {
      const chapterCard = document.createElement('li');
      chapterCard.className = 'chapter-card';

      // Ajout d'une animation fadeInUp avec un d√©lai progressif (pour effet en cascade)
      chapterCard.style.animation = `fadeInUp 0.5s ease forwards`;
      chapterCard.style.animationDelay = `${idx * 0.15}s`;

      // Titre du chapitre
      const chapterTitle = document.createElement('div');
      chapterTitle.className = 'chapter-title';
      chapterTitle.textContent = chapitre.titre;

      // Sous-titre le√ßon
      const lessonSubtitle = document.createElement('div');
      lessonSubtitle.className = 'lesson-subtitle';
      lessonSubtitle.textContent = chapitre.lecon;

      // Ligne 1 : liens point contr√¥le, PDF1, PDF2, vid√©o1, vid√©o2
      const line1 = document.createElement('div');
      line1.className = 'line';

      const pointControleLink = document.createElement('a');
      pointControleLink.href = chapitre.pointControleLink;
      pointControleLink.target = "_blank";
      pointControleLink.className = 'pdf-link';
      pointControleLink.textContent = 'Participer au point contr√¥le';

      const pdf1Btn = document.createElement('a');
      pdf1Btn.href = chapitre.pdf1;
      pdf1Btn.target = "_blank";
      pdf1Btn.className = 'pdf-link';
      pdf1Btn.textContent = 'üìÑ PDF 1';

      const pdf2Btn = document.createElement('a');
      pdf2Btn.href = chapitre.pdf2;
      pdf2Btn.target = "_blank";
      pdf2Btn.className = 'pdf-link';
      pdf2Btn.textContent = 'üìÑ PDF 2';

      const video1 = document.createElement('a');
      video1.href = chapitre.video1;
      video1.target = "_blank";
      video1.className = 'video-link';
      video1.textContent = 'üé• Vid√©o 1';

      const video2 = document.createElement('a');
      video2.href = chapitre.video2;
      video2.target = "_blank";
      video2.className = 'video-link';
      video2.textContent = 'üé• Vid√©o 2';

      // Ajout des liens dans la ligne 1
      line1.appendChild(pointControleLink);
      line1.appendChild(pdf1Btn);
      line1.appendChild(pdf2Btn);
      line1.appendChild(video1);
      line1.appendChild(video2);

      // Ligne 2 : Boutons Description du cours et Suivi
      const line2 = document.createElement('div');
      line2.className = 'line';

      // Bouton Description, ouvre modal avec description du cours
      const descButton = document.createElement('button');
      descButton.className = 'desc-button';
      descButton.textContent = 'Description du cours';
      descButton.addEventListener('click', e => {
        e.stopPropagation(); // Emp√™che la propagation du clic (utile si besoin)
        openModal(`Description - ${chapitre.titre}`, chapitre.descriptionCours);
      });

      // R√©cup√©ration du statut suivi dans localStorage, sinon valeur par d√©faut
      let suiviStatus = getSuiviStatus(cours.titre, chapitre.titre);
      if (suiviStatus === null) suiviStatus = chapitre.suivi;

      // Bouton Suivi (indique si le chapitre est suivi ou non)
      const suiviBtn = document.createElement('button');
      suiviBtn.className = 'suivi-button ' + (suiviStatus ? 'suivi-true' : 'suivi-false');
      suiviBtn.textContent = suiviStatus ? 'Suivi' : 'Non suivi';

      // Gestion du clic sur bouton suivi : bascule statut, mise √† jour stockage et affichage
      suiviBtn.addEventListener('click', e => {
        e.stopPropagation();

        // Inversion du statut suivi
        suiviStatus = !suiviStatus;

        // Mise √† jour locale du suivi
        setSuiviStatus(cours.titre, chapitre.titre, suiviStatus);

        // Mise √† jour visuelle du bouton
        suiviBtn.textContent = suiviStatus ? 'Suivi' : 'Non suivi';
        suiviBtn.className = 'suivi-button ' + (suiviStatus ? 'suivi-true' : 'suivi-false');

        // Mise √† jour du stockage global 'suivis' (pour suivi global/progression)
        let allSuivis = JSON.parse(localStorage.getItem('suivis') || '{}');
        if (!allSuivis[cours.titre]) allSuivis[cours.titre] = [];

        if (suiviStatus && !allSuivis[cours.titre].includes(chapitre.titre)) {
          allSuivis[cours.titre].push(chapitre.titre);
        } else if (!suiviStatus && allSuivis[cours.titre].includes(chapitre.titre)) {
          allSuivis[cours.titre] = allSuivis[cours.titre].filter(titre => titre !== chapitre.titre);
        }

        localStorage.setItem('suivis', JSON.stringify(allSuivis));
      });

      // Ajout des boutons dans la ligne 2
      line2.appendChild(descButton);
      line2.appendChild(suiviBtn);

      // Assemblage complet de la carte chapitre
      chapterCard.appendChild(chapterTitle);
      chapterCard.appendChild(lessonSubtitle);
      chapterCard.appendChild(line1);
      chapterCard.appendChild(line2);

      // Ajout du chapitre √† la liste des chapitres
      chaptersList.appendChild(chapterCard);
    });

    // Assemblage carte cours
    courseCard.appendChild(courseTitle);
    courseCard.appendChild(chaptersList);

    // Ajout de la carte cours √† la liste globale
    courseListEl.appendChild(courseCard);
  });
}

// Affiche la liste des cours d√®s le chargement du script
renderCourseList();

  </script>

  <script>
    // Ouvre la fen√™tre modale pour ajouter un nouveau cours
function openAddCourseModal() {
  document.getElementById('addCourseModal').style.display = 'flex';
}

// Ferme la fen√™tre modale d'ajout et vide le message d'information
function closeAddCourseModal() {
  document.getElementById('addCourseModal').style.display = 'none';
  document.getElementById('addCourseMessage').innerHTML = '';
}

// Fonction pour ajouter un nouveau cours ou un chapitre √† un cours existant
function ajouterCours() {
  // R√©cup√©ration et nettoyage des valeurs saisies dans le formulaire
  const titre = document.getElementById('newCourseName').value.trim();
  const chapitreTitre = document.getElementById('newChapterName').value.trim();
  const lecon = document.getElementById('newLesson').value.trim();
  const desc = document.getElementById('newDescription').value.trim();
  const msgEl = document.getElementById('addCourseMessage');

  // V√©rification que tous les champs sont bien remplis
  if (!titre || !chapitreTitre || !lecon || !desc) {
    msgEl.style.color = 'red';
    msgEl.textContent = 'Veuillez remplir tous les champs.';
    return; // Stop la fonction si un champ est vide
  }

  // Recherche si le cours existe d√©j√† dans la liste globale allCourses
  let coursExist = allCourses.find(c => c.titre === titre);

  if (!coursExist) {
    // Si le cours n'existe pas, on le cr√©e avec son premier chapitre
    allCourses.push({
      titre: titre,
      chapitres: [{
        titre: chapitreTitre,
        lecon: lecon,
        suivi: false, // Par d√©faut, le chapitre n'est pas suivi
        pointControleLink: "#",
        descriptionCours: desc,
        pdf1: "#",
        pdf2: "#",
        video1: "#",
        video2: "#"
      }]
    });

    // Message de succ√®s pour ajout de cours et chapitre
    msgEl.style.color = 'green';
    msgEl.textContent = 'Cours et chapitre ajout√©s avec succ√®s.';
  } else {
    // Si le cours existe, on v√©rifie si le chapitre existe d√©j√†
    let chapitreExist = coursExist.chapitres.find(c => c.titre === chapitreTitre);

    if (!chapitreExist) {
      // Si le chapitre n'existe pas, on l'ajoute au cours existant
      coursExist.chapitres.push({
        titre: chapitreTitre,
        lecon: lecon,
        suivi: false,
        pointControleLink: "#",
        descriptionCours: desc,
        pdf1: "#",
        pdf2: "#",
        video1: "#",
        video2: "#"
      });

      // Message de succ√®s pour ajout de chapitre
      msgEl.style.color = 'green';
      msgEl.textContent = 'Chapitre ajout√© au cours existant.';
    } else {
      // Si le chapitre existe, on met √† jour la le√ßon et la description
      chapitreExist.lecon = lecon;
      chapitreExist.descriptionCours = desc;

      // Message d'information pour mise √† jour de la le√ßon
      msgEl.style.color = 'orange';
      msgEl.textContent = 'Le√ßon mise √† jour pour le chapitre existant.';
    }
  }

  // Rafra√Æchit l'affichage de la liste des cours pour refl√©ter les changements
  renderCourseList();

  // Ferme automatiquement la modale apr√®s 1.5 secondes
  setTimeout(closeAddCourseModal, 1500);
}

  </script>
  <script>
    // Ouvre la popup pour ajouter un nouveau cours
function ouvrirPopup() {
  document.getElementById('coursPopup').style.display = 'flex';
}

// Ferme la popup d'ajout de cours
function fermerPopup() {
  document.getElementById('coursPopup').style.display = 'none';
}

// Ajoute un cours √† la liste stock√©e dans localStorage
function ajouterCours() {
  // R√©cup√®re et nettoie les valeurs saisies dans le formulaire
  const nom = document.getElementById('coursNom').value.trim();
  const chapitre = document.getElementById('coursChapitre').value.trim();
  const description = document.getElementById('coursDescription').value.trim();
  const lien = document.getElementById('coursLien').value.trim();

  // V√©rifie que tous les champs sont remplis
  if (!nom || !chapitre || !description || !lien) {
    alert("Tous les champs sont obligatoires.");
    return; // Arr√™te la fonction si un champ est vide
  }

  // Cr√©e un objet repr√©sentant le nouveau cours
  const cours = { nom, description, lien };

  // R√©cup√®re les donn√©es actuelles ou cr√©e un objet vide si rien n'est stock√©
  let donnees = JSON.parse(localStorage.getItem("coursData") || "{}");

  // Si le chapitre n'existe pas encore, on l'initialise comme tableau vide
  if (!donnees[chapitre]) donnees[chapitre] = [];

  // Ajoute le nouveau cours au chapitre concern√©
  donnees[chapitre].push(cours);

  // Enregistre les donn√©es mises √† jour dans localStorage
  localStorage.setItem("coursData", JSON.stringify(donnees));

  // Ferme la popup apr√®s ajout r√©ussi
  fermerPopup();

  // Rafra√Æchit l'affichage des cours pour prendre en compte l'ajout
  afficherCours();
}

// Affiche tous les cours stock√©s dans localStorage sur la page
function afficherCours() {
  // R√©cup√®re le conteneur principal o√π afficher les cours
  const container = document.getElementById('coursContainer');

  // Vide le contenu pr√©c√©dent avant de r√©afficher la liste
  container.innerHTML = '';

  // R√©cup√®re les donn√©es des cours stock√©es localement
  let donnees = JSON.parse(localStorage.getItem("coursData") || "{}");

  // Parcourt chaque chapitre enregistr√©
  for (const chapitre in donnees) {
    // Cr√©e une section d√©di√©e √† ce chapitre avec un titre
    const section = document.createElement('div');
    section.innerHTML = `<h2>${chapitre}</h2>`;

    // Parcourt chaque cours dans ce chapitre
    donnees[chapitre].forEach(cours => {
      // Cr√©e une carte visuelle pour pr√©senter le cours
      const card = document.createElement('div');
      card.className = 'card';

      // Remplit la carte avec les informations du cours et les boutons d'action
      card.innerHTML = `
        <h3>${cours.nom}</h3>
        <p>${cours.description}</p>
        <button class="btn btn-bleu" onclick="window.open('${cours.lien}', '_blank')">Participer au point synchrone</button>
        <a href="choix_licence.html" class="btn btn-rouge cours-btn" style="text-decoration:none;">Cours</a>
      `;

      // Ajoute la carte √† la section du chapitre
      section.appendChild(card);
    });

    // Ajoute la section compl√®te au conteneur principal
    container.appendChild(section);
  }
}

// Charge et affiche les cours d√®s que la page est compl√®tement charg√©e
window.onload = afficherCours;

  </script>
</body>
</html>
